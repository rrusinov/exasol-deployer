{% raw -%}
# DigitalOcean-specific device discovery implementation
# DigitalOcean uses SCSI device naming with volume IDs
# Future agents: When adding DigitalOcean features, consider:
# - Different volume types and performance tiers
# - Volume attachment order consistency
# - Regional vs local volume differences

provider_init_discovery() {
    log "Initializing DigitalOcean volume discovery"
    # DigitalOcean doesn't require pre-discovery like Azure or libvirt
    # Volumes are discovered on-demand using volume IDs
}

provider_find_device() {
    local vol_id="$1"
    local volume_index="$2"  # 0-based index, unused for DigitalOcean (uses vol_id directly)
    
    log "Looking for DigitalOcean volume: $vol_id"
    
    # DigitalOcean volumes appear as SCSI devices with volume ID in the device name
    # Try multiple possible naming patterns including cleaned volume IDs
    local vol_id_clean="${vol_id//-/}"
    local target_device
    target_device=$(find_device_via_patterns "$vol_id" \
        "/dev/disk/by-id/scsi-0DO_Volume_${vol_id}" \
        "/dev/disk/by-id/scsi-0DO_Volume_volume-${vol_id}" \
        "/dev/disk/by-id/scsi-0DO_Volume_${vol_id_clean}" \
        "/dev/disk/by-id/scsi-0DO_Volume_volume-${vol_id_clean}") || true
    
    echo "$target_device"
}

provider_log_available_devices() {
    log_available_devices "Available DigitalOcean volumes:" "/dev/disk/by-id/scsi-0DO_Volume_*"
}
{%- endraw %}